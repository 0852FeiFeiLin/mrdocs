{% load staticfiles %}
<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}{% endblock %} - MrDoc</title>
    <link href="{% static 'layui/css/layui.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'editor.md/css/editormd.css' %}" />
    <link href="{% static 'style.css' %}" rel="stylesheet">
    {% block custom_style %}{% endblock %}
</head>
<body class="layui-layout-body">
<div class="layui-header">
    <div class="layui-main">
        <a class="logo" href="{% url 'pro_list' %}">
{#            <img src="/media/logo.png" />#}
            <h1>
                <strong>MrDoc</strong>
                <span style="font-size: 16px;">{% block subtitle %}{% endblock %}</span>
            </h1>
        </a>
        <ul class="layui-nav layui-layout-right">
            {% if request.user.is_authenticated %}
          <li class="layui-nav-item">
            <a href="javascript:void(0);">
              <i class="layui-icon layui-icon-username"></i> {{request.user.username}}
            </a>
            <dl class="layui-nav-child">
                <dd><a href="{% url 'manage_doc' %}">管理文档</a></dd>
{#                <dd><a href="javascript:void(0);">修改密码</a></dd>#}
                <dd><a href="{% url 'logout' %}">退出登录</a></dd>
            </dl>
          </li>
            {% else %}
            <li class="layui-nav-item">
            <a href="javascript:void(0);">
              <i class="layui-icon layui-icon-username"></i> 游客
            </a>
            <dl class="layui-nav-child">
              <!-- <dd><a href="">基本资料</a></dd> -->
              <dd><a href="javascript:void(0);">注册</a></dd>
                <dd><a href="{% url 'login' %}">登录</a></dd>
            </dl>
          </li>
            {% endif %}
        </ul>
    </div>
</div>
<div class="layui-main">
    {% block content %}
    {% endblock %}
</div>

<script src="https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
<script src="{% static 'layui/layui.all.js' %}"></script>
<script src="{% static 'editor.md/editormd.min.js' %}"></script>
<script>
    $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
        });
    var layer = layui.layer;
    var form = layui.form;
    //初始化editormd
    var editor = editormd("editor-md", {
        width       :   "100%",
        height      :   "1000px;",
        placeholder :   "开始使用Markdown书写……",
        path        :   "/static/editor.md/lib/",
        saveHTMLToTextarea : true,
        tex         :   true,//开启科学公式
        tocm        :   true,//开启下拉目录
        taskList    :   true,//开启任务列表
        tocTitle    :   '文章导读',//目录标题
        tocContainer:   '',
        tocDropdown :   false,
        emoji       :   true,//开启Emoji
        imageUpload    : true, //开启图片上传
        imageFormats   : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
        imageUploadURL : "{% url 'upload_doc_img' %}",
    });
    //粘贴上传图片
    $("#editor-md").on('paste', function (ev) {
        var data = ev.clipboardData;
        var items = (event.clipboardData || event.originalEvent.clipboardData).items;
        for (var index in items) {
            var item = items[index];
            if (item.kind === 'file') {
                var blob = item.getAsFile();
                var reader = new FileReader();
                reader.onload = function (event) {
                    var base64 = event.target.result;
                    //ajax上传图片
                    $.post("{% url 'upload_doc_img' %}",{base:base64}, function (ret) {
                        layer.msg(ret.message);
                        if (ret.success === 1) {
                            //新一行的图片显示
                            editor.insertValue("\n![](" + ret.url + ")");
                        }
                    });
                }; // data url!
                var url = reader.readAsDataURL(blob);
            }
        }
    });
</script>
{% block custom_script %}
{% endblock %}
</body>
{% block custom_div %}
<div class="doctemp-list" id="doctemp-list" style="display: none;width: 500px;">
    <div style="margin: 10px 0 0 10px;">
        <a class="layui-btn layui-btn-normal" href="{% url 'create_doctemp' %}" target="_blank">创建新模板</a>
        <a class="layui-btn layui-btn-normal" href="{% url 'manage_doctemp' %}" target="_blank">管理文档模板</a>
    </div>
    <table class="layui-table" style="margin: 10px;">
      <colgroup>
        <col width="150">
        <col width="200">
        <col>
      </colgroup>
      <thead>
        <tr>
          <th>模板名称</th>
          <th>创建时间</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for temp in doctemp_list %}
        <tr>
          <td>{{ temp.name }}</td>
          <td>{{ temp.create_time }}</td>
          <td>
              <a href="javascript:void(0);" onclick="insertTemp('{{temp.id}}');">选择模板</a>
{#              <a href="javascript:void(0);" onclick="modifyTemp();">修改</a>#}
{#              <a href="javascript:void(0);" onclick="delTemp();">删除</a>#}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
</div>
{% endblock %}
</html>