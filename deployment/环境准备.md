# 🛠️ MrDoc Ubuntu 环境准备文档

> **ubuntu_prepare.sh 脚本功能详解**

## 📋 概述

`ubuntu_prepare.sh` 是一个Ubuntu服务器的Docker环境一站式准备脚本，为MrDoc部署铺设完整的基础环境。

```
ubuntu_prepare.sh = Ubuntu服务器的Docker化部署环境准备工具
```

## 🎯 脚本主要职能

**将裸Ubuntu系统转换为具备Docker容器化能力的生产级部署环境**

- ✅ **系统级环境配置** - Docker、防火墙、性能优化
- ✅ **一次性基础设施准备** - 完成后无需重复执行
- ✅ **生产环境标准化** - 按照最佳实践配置系统参数

## 🔧 核心功能模块

### 1. 🔍 **系统检测与更新**

```bash
功能：
├── 检测Ubuntu系统版本（要求20.04+）
├── 更新系统软件包：apt update & upgrade
└── 安装基础工具：curl, wget, git, vim, unzip
```

**执行效果：**
- 确保系统版本兼容性
- 获取最新的安全更新
- 安装必要的基础工具

### 2. 🐳 **Docker生态安装**

```bash
功能：
├── 安装Docker CE（社区版）
├── 安装Docker Compose（容器编排工具）
├── 配置Docker服务自启动
└── 将当前用户加入docker组（免sudo使用）
```

**核心作用：**
- 提供容器化运行环境
- 支持多容器应用编排
- 简化容器操作权限

**安装版本：**
- Docker CE：最新稳定版
- Docker Compose：GitHub最新release版本

### 3. 🛡️ **安全配置**

```bash
功能：
├── 配置UFW防火墙
├── 开放必要端口：22(SSH), 80(HTTP), 443(HTTPS)
└── 增强系统安全基线
```

**端口配置：**
| 端口 | 协议 | 用途 | 状态 |
|------|------|------|------|
| 22 | TCP | SSH远程管理 | ✅ 开放 |
| 80 | TCP | HTTP Web服务 | ✅ 开放 |
| 443 | TCP | HTTPS安全访问 | ✅ 开放 |

### 4. 📁 **项目环境准备**

```bash
创建标准项目目录结构：
~/mrdoc-server/
├── config/     # 配置文件目录
├── data/       # 数据持久化目录
├── logs/       # 日志文件目录
├── media/      # 媒体文件目录
└── static/     # 静态文件目录
```

**目录作用：**
- **config/** - 存放应用配置文件
- **data/** - 数据库和持久化数据
- **logs/** - 应用和服务日志
- **media/** - 用户上传的媒体文件
- **static/** - CSS、JS等静态资源

### 5. ⚡ **系统性能优化**

```bash
优化项目：
├── 文件描述符限制调整（65536）
├── 内核参数优化：
│   ├── vm.max_map_count=262144     # 内存映射限制
│   ├── vm.swappiness=1             # 减少swap使用
│   └── net.core.somaxconn=65535    # 网络连接队列
└── 应用优化配置生效
```

**性能提升：**
- 支持更多并发连接
- 优化容器内存管理
- 提升网络处理能力
- 减少磁盘IO等待

### 6. 🛠️ **运维工具安装**

```bash
工具分类：
├── 监控工具：htop, iotop, nethogs
├── 实用工具：tree, jq, sqlite3, mysql-client
└── Web服务：nginx, certbot (SSL证书工具)
```

**工具用途：**
- **htop** - 系统资源监控
- **iotop** - 磁盘IO监控
- **nethogs** - 网络流量监控
- **tree** - 目录结构显示
- **jq** - JSON数据处理
- **mysql-client** - 数据库客户端
- **nginx** - Web服务器
- **certbot** - 免费SSL证书申请

## 📊 执行前后对比

| 执行前状态 | 执行后状态 |
|------------|------------|
| 🔴 裸Ubuntu系统 | ✅ Docker化生产环境 |
| 🔴 缺少容器支持 | ✅ Docker + Docker Compose |
| 🔴 基础安全配置 | ✅ 防火墙 + 端口管理 |
| 🔴 无项目结构 | ✅ 标准化目录结构 |
| 🔴 默认系统参数 | ✅ 容器优化参数 |
| 🔴 缺少运维工具 | ✅ 完整监控工具链 |

## ✅ 脚本执行完成后效果

### 🎯 **你的服务器将具备：**

1. **🐳 完整的Docker容器化环境**
   - Docker CE 最新版
   - Docker Compose 编排工具
   - 用户免sudo操作权限

2. **🛡️ 生产级的安全配置**
   - UFW防火墙启用
   - 必要端口开放
   - 安全基线加固

3. **⚡ 性能优化的系统参数**
   - 文件描述符限制提升
   - 内核参数优化
   - 容器运行优化

4. **📁 标准化的项目目录结构**
   - 规范的目录布局
   - 数据持久化准备
   - 配置文件分离

5. **🛠️ 齐全的运维监控工具**
   - 系统监控工具
   - 网络分析工具
   - Web服务支持

### 🔄 **持久性特征**

**为什么一次执行就够？**

- **🏗️ 基础设施性质** - Docker环境一旦安装，持续可用
- **🔒 系统级配置** - 防火墙、内核参数等配置永久生效
- **👥 用户权限设置** - docker组权限配置持久有效
- **📦 软件包管理** - 已安装的工具包持续可用
- **⚙️ 服务自启动** - Docker服务开机自动启动

## 🚀 后续部署流程

### 环境准备完成后，下一步：

```bash
# 1. 重新登录激活docker组权限
logout
ssh user@server

# 2. 验证环境就绪
docker --version
docker-compose --version

# 3. 执行MrDoc安全部署
./deploy_safe_mrdoc.sh
```

## 📝 注意事项

### ⚠️ **系统要求**
- **操作系统**: Ubuntu 20.04+
- **内存**: 最低2GB，推荐4GB+
- **磁盘**: 最低20GB，推荐50GB+
- **网络**: 稳定的互联网连接

### 🔧 **执行要求**
- 使用普通用户执行（非root）
- 确保用户具有sudo权限
- 服务器有公网IP访问能力

### 💡 **最佳实践**
- 建议在全新Ubuntu系统上执行
- 执行前做好系统备份
- 确保网络连接稳定
- 准备好域名（可选）

## 🎉 总结

**`ubuntu_prepare.sh` 是一次性的环境准备脚本，它将：**

- 🔄 **转换** - 将裸Ubuntu转换为Docker化环境
- 🛡️ **加固** - 提供生产级安全配置
- ⚡ **优化** - 调整系统参数提升性能
- 🛠️ **装备** - 安装完整的运维工具链

**执行完成后，你的服务器就具备了运行MrDoc容器化应用的所有基础条件，无需重复执行此脚本。**

---

📋 **下一步文档**: [SAFE_DEPLOYMENT_PLAN.md](./SAFE_DEPLOYMENT_PLAN.md) - MrDoc安全部署方案