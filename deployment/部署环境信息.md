# MrDoc éƒ¨ç½²çŽ¯å¢ƒä¿¡æ¯

## ðŸ“‹ çŽ¯å¢ƒæ¦‚è§ˆ

**éƒ¨ç½²æ—¶é—´**: 2025-09-30
**æœåŠ¡å™¨IP**: 10.23.72.66ï¼ˆå†…ç½‘ï¼‰
**éƒ¨ç½²æ–¹å¼**: Docker Compose
**æ•°æ®åº“**: SQLite3
**ç¼“å­˜**: Redis 7
**WebæœåŠ¡å™¨**: Nginx + Gunicorn

---

## ðŸŒ æœåŠ¡è®¿é—®ä¿¡æ¯

### 1. Web åº”ç”¨ï¼ˆä¸»å…¥å£ï¼‰

**è®¿é—®åœ°å€**:
- å†…ç½‘: `http://10.23.72.66:8081`
- å¤–ç½‘: `http://202.79.167.23:8081`ï¼ˆå¦‚å·²é…ç½®ï¼‰
- æœ¬åœ°: `http://localhost:8081`

**å®¹å™¨åç§°**: `mrdocs-safe-nginx` + `mrdocs-safe-app`

**ç«¯å£æ˜ å°„**:
```
å¤–éƒ¨ç«¯å£ 8081 â†’ Nginx å®¹å™¨ç«¯å£ 80 â†’ åº”ç”¨å®¹å™¨ç«¯å£ 8000
å¤–éƒ¨ç«¯å£ 8443 â†’ Nginx å®¹å™¨ç«¯å£ 443 (HTTPSï¼Œæœªå¯ç”¨)
```

**æž¶æž„æµç¨‹**:
```
ç”¨æˆ·è¯·æ±‚ â†’ Nginx (8081) â†’ åå‘ä»£ç† â†’ Django App (8000)
                      â†“
                  é™æ€æ–‡ä»¶ç›´æŽ¥è¿”å›ž
```

---

### 2. ç®¡ç†å‘˜è´¦å·

**ç™»å½•åœ°å€**: `http://10.23.72.66:8081/admin/`

| é¡¹ç›® | å€¼ |
|------|-----|
| ç”¨æˆ·å | `admin` |
| å¯†ç  | `admin123456` |
| é‚®ç®± | `admin@example.com` |

**âš ï¸ å®‰å…¨å»ºè®®**:
- é¦–æ¬¡ç™»å½•åŽç«‹å³ä¿®æ”¹å¯†ç 
- ä½¿ç”¨å¼ºå¯†ç ï¼ˆå»ºè®®ï¼šå¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šå­—ç¬¦ï¼Œ12ä½ä»¥ä¸Šï¼‰
- å®šæœŸæ›´æ¢å¯†ç 

---

### 3. Redis ç¼“å­˜

**å®¹å™¨åç§°**: `mrdocs-safe-redis`

**è®¿é—®æ–¹å¼**:

#### ä»Žå®¿ä¸»æœºè®¿é—®
```bash
# è¿žæŽ¥å‘½ä»¤
redis-cli -h 10.23.72.66 -p 6380 -a redispassword123

# æˆ–ä½¿ç”¨æœ¬åœ°è¿žæŽ¥
redis-cli -p 6380 -a redispassword123
```

#### ä»Žåº”ç”¨å®¹å™¨è®¿é—®
```bash
# è¿›å…¥åº”ç”¨å®¹å™¨
docker exec -it mrdocs-safe-app bash

# è¿žæŽ¥ Redisï¼ˆå®¹å™¨å†…éƒ¨ï¼‰
redis-cli -h mrdocs-safe-redis -p 6379 -a redispassword123
```

**è¿žæŽ¥ä¿¡æ¯**:
| é¡¹ç›® | å€¼ |
|------|-----|
| ä¸»æœºï¼ˆå¤–éƒ¨ï¼‰ | `10.23.72.66` |
| ç«¯å£ï¼ˆå¤–éƒ¨ï¼‰ | `6380` |
| ä¸»æœºï¼ˆå®¹å™¨å†…ï¼‰ | `mrdocs-safe-redis` |
| ç«¯å£ï¼ˆå®¹å™¨å†…ï¼‰ | `6379` |
| å¯†ç  | `redispassword123` |
| æ•°æ®åº“ç¼–å· | `4` |

**å¸¸ç”¨å‘½ä»¤**:
```bash
# æµ‹è¯•è¿žæŽ¥
redis-cli -p 6380 -a redispassword123 ping

# æŸ¥çœ‹ä¿¡æ¯
redis-cli -p 6380 -a redispassword123 info

# æŸ¥çœ‹æ‰€æœ‰é”®
redis-cli -p 6380 -a redispassword123 --scan

# æŸ¥çœ‹ç‰¹å®šæ•°æ®åº“
redis-cli -p 6380 -a redispassword123 -n 4 keys '*'

# æ¸…ç©ºç¼“å­˜ï¼ˆè°¨æ…Žæ“ä½œï¼ï¼‰
redis-cli -p 6380 -a redispassword123 -n 4 FLUSHDB
```

---

### 4. æ•°æ®åº“ï¼ˆSQLiteï¼‰

**æ•°æ®åº“ç±»åž‹**: SQLite3

**æ•°æ®åº“ä½ç½®**:
- å®¿ä¸»æœº: `/root/kt/mrdocs/config/db.sqlite3`
- å®¹å™¨å†…: `/app/config/db.sqlite3`

**è®¿é—®æ–¹å¼**:
```bash
# ä»Žå®¿ä¸»æœºè®¿é—®
sqlite3 /root/kt/mrdocs/config/db.sqlite3

# ä»Žå®¹å™¨å†…è®¿é—®
docker exec -it mrdocs-safe-app sqlite3 /app/config/db.sqlite3

# é€šè¿‡ Django Shell è®¿é—®
docker exec -it mrdocs-safe-app python manage.py dbshell
```

**å¸¸ç”¨ SQL å‘½ä»¤**:
```sql
-- æŸ¥çœ‹æ‰€æœ‰è¡¨
.tables

-- æŸ¥çœ‹è¡¨ç»“æž„
.schema auth_user

-- æŸ¥è¯¢ç”¨æˆ·
SELECT id, username, email, is_superuser FROM auth_user;

-- é€€å‡º
.quit
```

**å¤‡ä»½å‘½ä»¤**:
```bash
cp /root/kt/mrdocs/config/db.sqlite3 /backup/db_$(date +%Y%m%d_%H%M%S).sqlite3
```

---

### 5. Nginx é…ç½®

**å®¹å™¨åç§°**: `mrdocs-safe-nginx`

**é…ç½®æ–‡ä»¶ä½ç½®**:
- ä¸»é…ç½®: `/root/kt/mrdocs/deployment/nginx/nginx.conf`
- ç«™ç‚¹é…ç½®: `/root/kt/mrdocs/deployment/nginx/mrdoc.conf`

**æ—¥å¿—æŸ¥çœ‹**:
```bash
# å®žæ—¶æŸ¥çœ‹è®¿é—®æ—¥å¿—
docker logs -f mrdocs-safe-nginx

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker logs mrdocs-safe-nginx 2>&1 | grep error

# æœ€è¿‘100è¡Œæ—¥å¿—
docker logs --tail 100 mrdocs-safe-nginx
```

**é…ç½®æµ‹è¯•**:
```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
docker exec mrdocs-safe-nginx nginx -t

# é‡æ–°åŠ è½½é…ç½®ï¼ˆæ— éœ€é‡å¯ï¼‰
docker exec mrdocs-safe-nginx nginx -s reload

# é‡å¯ Nginx
docker-compose restart mrdocs-safe-nginx
```

**é™æ€æ–‡ä»¶è·¯å¾„**:
- å®¹å™¨å†…: `/var/www/static/`
- å®¿ä¸»æœº: `/root/kt/mrdocs/static/`

**åª’ä½“æ–‡ä»¶è·¯å¾„**:
- å®¹å™¨å†…: `/var/www/media/`
- å®¿ä¸»æœº: `/root/kt/mrdocs/media/`

---

## ðŸ” å®‰å…¨å‡­æ®æ±‡æ€»

### Django åº”ç”¨

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| SECRET_KEY | `django_safe_secret_6WZlZsnpSV78ie9OZDmXPFodGnGWc2FNjJBuOIQqhPc` |
| DEBUG | `False` |
| ALLOWED_HOSTS | `*` |

### ç®¡ç†å‘˜è´¦å·

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| ç”¨æˆ·å | `admin` |
| å¯†ç  | `admin123456` |
| é‚®ç®± | `admin@example.com` |

### Redis å‡­æ®

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| å¯†ç  | `redispassword123` |
| æ•°æ®åº“ | `4` |

---

## ðŸ“ ç›®å½•ç»“æž„

### é¡¹ç›®æ–‡ä»¶ä½ç½®

```
/root/kt/mrdocs/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ db.sqlite3           # SQLite æ•°æ®åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ config.ini           # åº”ç”¨é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ uwsgi.ini            # uWSGI é…ç½®ï¼ˆæœªä½¿ç”¨ï¼‰
â”œâ”€â”€ media/                   # åª’ä½“æ–‡ä»¶ï¼ˆç”¨æˆ·ä¸Šä¼ ï¼‰
â”œâ”€â”€ static/                  # é™æ€æ–‡ä»¶ï¼ˆCSS/JS/å›¾ç‰‡ï¼‰
â”œâ”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ deployment/
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ docker-compose.yml    # Docker ç¼–æŽ’æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ Dockerfile.mrdoc      # åº”ç”¨é•œåƒæž„å»ºæ–‡ä»¶
â”‚   â”‚   â””â”€â”€ entrypoint.sh         # å®¹å™¨å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ nginx/
â”‚       â”œâ”€â”€ nginx.conf            # Nginx ä¸»é…ç½®
â”‚       â””â”€â”€ mrdoc.conf            # MrDoc ç«™ç‚¹é…ç½®
â””â”€â”€ deployment/
    â”œâ”€â”€ éƒ¨ç½²æ–‡æ¡£.md
    â”œâ”€â”€ ç»´æŠ¤æ“ä½œæ‰‹å†Œ.md
    â”œâ”€â”€ å®‰å…¨æ›´æ–°æµç¨‹.md
    â””â”€â”€ éƒ¨ç½²çŽ¯å¢ƒä¿¡æ¯.md       # æœ¬æ–‡ä»¶
```

### å¤‡ä»½ç›®å½•

```
/backup/mrdocs/
â””â”€â”€ YYYYMMDD_HHMMSS/        # æŒ‰æ—¶é—´æˆ³å‘½åçš„å¤‡ä»½
    â”œâ”€â”€ db.sqlite3          # æ•°æ®åº“å¤‡ä»½
    â”œâ”€â”€ config.tar.gz       # é…ç½®æ–‡ä»¶å¤‡ä»½
    â”œâ”€â”€ media.tar.gz        # åª’ä½“æ–‡ä»¶å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ git_version.txt     # Git ç‰ˆæœ¬è®°å½•
    â”œâ”€â”€ container_status.txt # å®¹å™¨çŠ¶æ€è®°å½•
    â””â”€â”€ update_log.txt      # æ›´æ–°æ—¥å¿—
```

---

## ðŸ³ Docker å®¹å™¨ä¿¡æ¯

### å®¹å™¨åˆ—è¡¨

| å®¹å™¨åç§° | é•œåƒ | çŠ¶æ€ | ç«¯å£æ˜ å°„ |
|---------|------|------|---------|
| mrdocs-safe-nginx | nginx:alpine | Up (healthy) | 8081â†’80, 8443â†’443 |
| mrdocs-safe-app | docker-mrdocs-safe-app | Up (healthy) | å†…ç½‘8000 |
| mrdocs-safe-redis | redis:7-alpine | Up (healthy) | 6380â†’6379 |

### ç½‘ç»œä¿¡æ¯

**ç½‘ç»œåç§°**: `docker_mrdocs-safe-network`

**ç½‘ç»œç±»åž‹**: Bridge

**å­ç½‘é…ç½®**:
- å­ç½‘: `172.31.0.0/16`
- ç½‘å…³: `172.31.0.1`

**å®¹å™¨å†…ç½‘åœ°å€**:
```bash
# æŸ¥çœ‹å®¹å™¨IP
docker inspect mrdocs-safe-app --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'
docker inspect mrdocs-safe-nginx --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'
docker inspect mrdocs-safe-redis --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'
```

### æ•°æ®å·

| å·åç§° | ç”¨é€” | æŒ‚è½½ç‚¹ |
|--------|------|--------|
| sqlite_data | SQLite æ•°æ®æŒä¹…åŒ– | /app/db |
| mrdocs-safe_redis_data | Redis æ•°æ®æŒä¹…åŒ– | /data |

---

## ðŸ”§ å¸¸ç”¨æ“ä½œå‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps --filter "name=mrdocs-safe"

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect mrdocs-safe-app

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats mrdocs-safe-app mrdocs-safe-nginx mrdocs-safe-redis
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# åº”ç”¨æ—¥å¿—
docker logs -f mrdocs-safe-app

# Nginx æ—¥å¿—
docker logs -f mrdocs-safe-nginx

# Redis æ—¥å¿—
docker logs -f mrdocs-safe-redis

# æ‰€æœ‰æœåŠ¡æ—¥å¿—
cd /root/kt/mrdocs/deployment/docker
docker-compose logs -f
```

### è¿›å…¥å®¹å™¨
```bash
# è¿›å…¥åº”ç”¨å®¹å™¨
docker exec -it mrdocs-safe-app bash

# è¿›å…¥ Nginx å®¹å™¨
docker exec -it mrdocs-safe-nginx sh

# è¿›å…¥ Redis å®¹å™¨
docker exec -it mrdocs-safe-redis sh
```

### é‡å¯æœåŠ¡
```bash
cd /root/kt/mrdocs/deployment/docker

# é‡å¯å•ä¸ªæœåŠ¡
docker-compose restart mrdocs-safe-app

# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d
```

---

## ðŸŒ çŽ¯å¢ƒå˜é‡

### åº”ç”¨çŽ¯å¢ƒå˜é‡

æŸ¥çœ‹æ‰€æœ‰çŽ¯å¢ƒå˜é‡ï¼š
```bash
docker exec mrdocs-safe-app env
```

å…³é”®çŽ¯å¢ƒå˜é‡ï¼š
```bash
DB_ENGINE=sqlite
DB_NAME=/app/config/db.sqlite3
REDIS_HOST=mrdocs-safe-redis
REDIS_PORT=6379
REDIS_PASSWORD=redispassword123
REDIS_DB=4
DJANGO_SETTINGS_MODULE=MrDoc.settings
DJANGO_SECRET_KEY=django_safe_secret_6WZlZsnpSV78ie9OZDmXPFodGnGWc2FNjJBuOIQqhPc
DJANGO_DEBUG=False
DJANGO_ALLOWED_HOSTS=*
DJANGO_SUPERUSER_USERNAME=admin
DJANGO_SUPERUSER_EMAIL=admin@example.com
DJANGO_SUPERUSER_PASSWORD=admin123456
TZ=Asia/Shanghai
```

---

## ðŸ”’ å®‰å…¨å»ºè®®

### ç«‹å³æ‰§è¡Œ

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   ```bash
   # ç™»å½•åº”ç”¨åŽå°ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 
   # è®¿é—®: http://10.23.72.66:8081/admin/
   ```

2. **ä¿®æ”¹ Redis å¯†ç **
   ```bash
   # ç¼–è¾‘ docker-compose.yml
   vim /root/kt/mrdocs/deployment/docker/docker-compose.yml
   # ä¿®æ”¹: REDIS_PASSWORD=your-strong-password
   # é‡å¯: docker-compose restart
   ```

3. **ä¿®æ”¹ Django SECRET_KEY**
   ```bash
   # ç”Ÿæˆæ–°çš„å¯†é’¥
   docker exec mrdocs-safe-app python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"

   # ä¿®æ”¹ docker-compose.yml ä¸­çš„ DJANGO_SECRET_KEY
   # é‡å¯å®¹å™¨
   ```

### é•¿æœŸç»´æŠ¤

1. **é™åˆ¶ç®¡ç†åŽå°è®¿é—®**
   - é…ç½® IP ç™½åå•
   - ä½¿ç”¨ VPN è®¿é—®

2. **å¯ç”¨ HTTPS**
   - é…ç½® SSL è¯ä¹¦
   - ä¿®æ”¹ nginx é…ç½®

3. **å®šæœŸå¤‡ä»½**
   - è®¾ç½®è‡ªåŠ¨å¤‡ä»½è„šæœ¬
   - å¼‚åœ°å¤‡ä»½é‡è¦æ•°æ®

4. **ç›‘æŽ§æ—¥å¿—**
   - å®šæœŸæ£€æŸ¥é”™è¯¯æ—¥å¿—
   - è®¾ç½®å¼‚å¸¸å‘Šè­¦

5. **æ›´æ–°ä¾èµ–**
   - å®šæœŸæ›´æ–° Docker é•œåƒ
   - æ›´æ–° Python ä¾èµ–åŒ…

---

## ðŸ“ž æ•…éšœæŽ’æŸ¥

### åº”ç”¨æ— æ³•è®¿é—®

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps --filter "name=mrdocs-safe"

# 2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker logs --tail 50 mrdocs-safe-app

# 3. æµ‹è¯•åº”ç”¨å®¹å™¨
curl -I http://localhost:8081

# 4. æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep 8081
```

### Redis è¿žæŽ¥å¤±è´¥

```bash
# 1. æ£€æŸ¥ Redis å®¹å™¨
docker ps --filter "name=redis"

# 2. æµ‹è¯• Redis è¿žæŽ¥
redis-cli -p 6380 -a redispassword123 ping

# 3. æŸ¥çœ‹ Redis æ—¥å¿—
docker logs mrdocs-safe-redis
```

### é™æ€æ–‡ä»¶ 404

```bash
# 1. æ¢å¤é™æ€æ–‡ä»¶
cd /root/kt/mrdocs
git restore static/

# 2. æ”¶é›†é™æ€æ–‡ä»¶
docker exec mrdocs-safe-app python manage.py collectstatic --noinput

# 3. é‡å¯ Nginx
docker-compose restart mrdocs-safe-nginx
```

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æ–‡æ¡£](./éƒ¨ç½²æ–‡æ¡£.md) - å®Œæ•´çš„éƒ¨ç½²æµç¨‹
- [ç»´æŠ¤æ“ä½œæ‰‹å†Œ](./ç»´æŠ¤æ“ä½œæ‰‹å†Œ.md) - æ—¥å¸¸ç»´æŠ¤æ“ä½œ
- [å®‰å…¨æ›´æ–°æµç¨‹](./å®‰å…¨æ›´æ–°æµç¨‹.md) - ä»£ç æ›´æ–°æŒ‡å—

---

## ðŸ“ å¿«é€Ÿå‚è€ƒå¡ç‰‡

### ä¸€é”®ä¿¡æ¯æŸ¥è¯¢

```bash
# ä¿å­˜ä»¥ä¸‹è„šæœ¬ä¸º /root/show_info.sh
cat > /root/show_info.sh << 'EOF'
#!/bin/bash
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "MrDoc éƒ¨ç½²çŽ¯å¢ƒä¿¡æ¯"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ðŸŒ Webè®¿é—®: http://$(hostname -I | awk '{print $1}'):8081"
echo "ðŸ‘¤ ç®¡ç†å‘˜: admin / admin123456"
echo "ðŸ—„ï¸ Redis: $(hostname -I | awk '{print $1}'):6380"
echo "ðŸ”‘ Rediså¯†ç : redispassword123"
echo "ðŸ’¾ æ•°æ®åº“: /root/kt/mrdocs/config/db.sqlite3"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "å®¹å™¨çŠ¶æ€:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
docker ps --filter "name=mrdocs-safe" --format "table {{.Names}}\t{{.Status}}"
EOF

chmod +x /root/show_info.sh
```

ä½¿ç”¨æ–¹å¼ï¼š
```bash
/root/show_info.sh
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-09-30
**ç»´æŠ¤äººå‘˜**: Arise

**âš ï¸ é‡è¦æç¤º**:
- æœ¬æ–‡æ¡£åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œè¯·å¦¥å–„ä¿ç®¡
- ä¿®æ”¹å¯†ç åŽåŠæ—¶æ›´æ–°æœ¬æ–‡æ¡£
- å®šæœŸæ£€æŸ¥å¹¶æ›´æ–°é…ç½®ä¿¡æ¯
